---
import "../styles/global.css";
---
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Partidas de Pool</title>
</head>
<body class="bg-gray-100 text-gray-800 p-6">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">游꿤 Registro de Partidas de Pool</h1>

    <form id="formulario" class="bg-white p-4 rounded shadow mb-6" onsubmit="event.preventDefault(); agregarPartida();">
        <div class="mb-4">
          <label class="block font-semibold mb-1">Fecha</label>
          <input id="fecha" type="date" required class="w-full border p-2 rounded" />
        </div>
      
        <div class="mb-4">
          <label class="block font-semibold mb-2">Selecciona los Jugadores (m치x 3)</label>
          <div id="jugadoresCheckboxes" class="flex flex-col gap-2">
            <label><input type="checkbox" name="jugador" value="Iv치n" class="mr-2 jugadorCheck">Iv치n</label>
            <label><input type="checkbox" name="jugador" value="Fatyka" class="mr-2 jugadorCheck">Fatyka</label>
            <label><input type="checkbox" name="jugador" value="Yuri" class="mr-2 jugadorCheck">Yuri</label>
          </div>
        </div>
      
        <div class="mb-4">
          <label class="block font-semibold mb-1">Ganador</label>
          <select id="ganador" required class="w-full border p-2 rounded">
            <option disabled selected>Selecciona un ganador</option>
          </select>
        </div>
      
        <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Agregar partida</button>
      </form>
      
      


    <table class="w-full bg-white rounded shadow text-sm">
      <thead>
        <tr class="bg-blue-200 text-left">
          <th class="px-4 py-2">Fecha</th>
          <th class="px-4 py-2">Jugador 1</th>
          <th class="px-4 py-2">Jugador 2</th>
          <th class="px-4 py-2">Jugador 3</th>
          <th class="px-4 py-2">Ganador</th>
        </tr>
      </thead>
      <tbody id="tablaPartidas"></tbody>
    </table>
  </div>


  
  <!-- Firebase CDN con m칩dulo -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCvAkjnBWvfNnDyzistVBFP2mZcymrRRQo",
      authDomain: "trinity-pool.firebaseapp.com",
      databaseURL: "https://trinity-pool-default-rtdb.firebaseio.com",
      projectId: "trinity-pool",
      storageBucket: "trinity-pool.appspot.com",
      messagingSenderId: "808109751915",
      appId: "1:808109751915:web:19dea37524c488b15dbb2e",
      measurementId: "G-VKMELEK8QH"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);

    const db = getDatabase(app);
    const partidasRef = ref(db, "partidas");

    // Mostrar partidas
    onValue(partidasRef, (snapshot) => {
      const data = snapshot.val();
      const tbody = document.getElementById("tablaPartidas");
      tbody.innerHTML = "";

      if (data) {
        Object.values(data).forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="border px-4 py-2">${row.fecha}</td>
            <td class="border px-4 py-2">${row.jugador1}</td>
            <td class="border px-4 py-2">${row.jugador2}</td>
            <td class="border px-4 py-2">${row.jugador3}</td>
            <td class="border px-4 py-2 font-bold">${row.ganador}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    });

    //Agregar partida
    window.agregarPartida = () => {
  const checkboxes = document.querySelectorAll('input[name="jugador"]:checked');
  const jugadoresSeleccionados = Array.from(checkboxes).map(cb => cb.value);

  if (jugadoresSeleccionados.length < 2 || jugadoresSeleccionados.length > 3) {
    alert("Debes seleccionar entre 2 y 3 jugadores.");
    return;
  }

  const nuevaPartida = {
    fecha: document.getElementById("fecha").value,
    jugador1: jugadoresSeleccionados[0] || null,
    jugador2: jugadoresSeleccionados[1] || null,
    jugador3: jugadoresSeleccionados[2] || null,
    ganador: document.getElementById("ganador").value
  };
  
  const ganadorSelect = document.getElementById("ganador");
if (!ganadorSelect.value || ganadorSelect.selectedIndex === 0) {
  alert("Debes seleccionar un ganador.");
  return;
}


  push(partidasRef, nuevaPartida);
  document.getElementById("formulario").reset();
  actualizarGanador(); // limpia el select despu칠s del reset
};

// 游대 Actualiza el select de "ganador" seg칰n jugadores seleccionados
function actualizarGanador() {
  const checkboxes = document.querySelectorAll('input[name="jugador"]:checked');
  const ganadorSelect = document.getElementById("ganador");

  ganadorSelect.innerHTML = '<option disabled selected>Selecciona un ganador</option>';
  checkboxes.forEach(cb => {
    const option = document.createElement("option");
    option.value = cb.value;
    option.textContent = cb.value;
    ganadorSelect.appendChild(option);
  });
}

// 游꿢 Escuchar cambios en los checkboxes
document.querySelectorAll('.jugadorCheck').forEach(cb => {
  cb.addEventListener('change', actualizarGanador);
});

  </script>
</body>
</html>
